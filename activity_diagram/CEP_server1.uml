@startuml
start
:SST Cloud Server: Intiailize server;

fork

-> Initiate ML agent;

repeat:Start learning\n ML Models;

if (CPU idle?) then ([yes])

  :Train new ML model;

  :Deploy new ML model
   for analytics;
else ([no])
  :wait 1 min;
endif 
repeat while(quit?) is ([no])

fork again

-> Initiate Anaytics agent;
repeat: Start analyzing\n preferences\n and trends
if (CPU idle?) then ([yes])
  :Analyze preferences;
  :Analyze trends;
else ([no])
  :wait 1 min;
endif
repeat while (quit?) is ([no])

fork again

-> Initiate Payment agent;

repeat:Wait 15 days;

if (Bill time?) then ([yes])
  :Check purchased\n services and\n plans;
  :Generate bills;
  :Store bills to DB;
  :Report bills\n to users;
else ([no])
  :Make payments\n with registered\n creditcards\naccording to bills;
endif     
repeat while(quit?) is ([no])

fork again

-> Initiate an agent for managing subscription;
repeat:Receive a subcription-related request;
  -> if the "Request" is;
  if ("Register Service"?) then ([yes])
    if (Conformance Test?) then ([pass])
      :Add Service
       to Registry;
    else ([not pass])
      :Request
       conformance;
    endif
    
  elseif ("Manage Service\n and app"?) then ([yes])
    :Manage Service\n and app;

  elseif ("Get service\n list"?) then ([yes])
    :Get list
     from Registry;
    :Deliver the list; 
  elseif ("Retrieve service\n recommendation") then ([yes])
    :Check Face ID;
    :Check user's history;
    :Run ML Algorithm;
    :Report recommendation;
  else (Handle other
   requests)
  endif

repeat while (quit?) is ([no])

endfork

stop
@enduml